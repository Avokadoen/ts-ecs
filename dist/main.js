!function(t){var e={};function n(s){if(e[s])return e[s].exports;var i=e[s]={i:s,l:!1,exports:{}};return t[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(s,i,function(e){return t[e]}.bind(null,i));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";var s;n.r(e),n.d(e,"EntityBuilder",(function(){return i})),n.d(e,"ECSManager",(function(){return o})),function(t){t[t.FIRST=0]="FIRST",t[t.AND=1]="AND",t[t.OR=2]="OR"}(s||(s={}));class i{constructor(t,e){this.id=t,this.ecsManager=e}get entityId(){return this.id}addComponent(t){return this.ecsManager.addComponent(this.id,t)}}class o{constructor(){this.events=[],this.systems=[],this.entities=[],this.components=new Map,this.entityId=0}registerEvent(t,e){return this.events.push({qResult:this.queryComponents(e),system:t}),this.events.length-1}registerSystem(t,e){this.systems.push({qResult:this.queryComponents(e),system:t})}createEntity(){return this.entities.push({id:this.entityId++}),new i(this.entityId-1,this)}createEntityWithComponents(t){const e=this.createEntity();for(const n of t)this.addComponent(e.entityId,n);return new i(this.entityId-1,this)}addComponent(t,e){const n=e.identifier();this.components.has(n)||this.components.set(n,new Array);const s={entityId:t,data:e};return this.components.get(n).push(s),new i(t,this)}queryEntities(t){const e=(t,e)=>(t.find(t=>t.id===e.entityId)||t.push({id:e.entityId}),t);let n=[];for(const i of t){const t=this.components.get(i.componentIdentifier).filter(t=>!isNaN(t.entityId)).reduce(e,[]);switch(i.token){case s.FIRST:n=t;break;case s.AND:const e=t.length<n.length?t:n,i=t.length>=n.length?t:n;n=[];for(const t of e)i.find(e=>e===t)&&n.push(t);break;case s.OR:n=n.concat(t).reduce((t,e)=>(t.find(t=>t.id===e.id)||t.push(e),t),[])}}return n}queryComponents(t){const e=t.reduce((t,e)=>(t.find(t=>t===e.componentIdentifier)||t.push(e.componentIdentifier),t),[]),n=this.queryEntities(t),s={entities:[]};for(const t of e)for(const e of n){const n=this.components.get(t).findIndex(t=>t.entityId===e);if(n>=0){let i=s.entities.findIndex(t=>t.entity.id===e.id);-1===i&&(s.entities.push({entity:e,components:new Map}),i=s.entities.length-1),s.entities.find(t=>t.entity.id===e.id).components.set(t,n)}}return s}createArgs(t){const e=[];for(const n of t.components){const t=this.components.get(n[0])[n[1]];e.push(t)}return e}onEvent(t,e){for(const n of this.events[t].qResult.entities){const s=this.createArgs(n);this.events[t].system(e,s)}}dispatch(){this.prevRun=this.prevRun?this.prevRun:Date.now();const t=Date.now(),e=(t-this.prevRun)/1e3;for(const t of this.systems)for(const n of t.qResult.entities){const s=this.createArgs(n);t.system(e,s)}this.prevRun=t}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vZWNzL2VzYy1xdWVyeS50cyIsIndlYnBhY2s6Ly8vLi9lY3MvbWFuYWdlci50cyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIlF1ZXJ5VG9rZW4iLCJFbnRpdHlCdWlsZGVyIiwiaWQiLCJlY3NNYW5hZ2VyIiwidGhpcyIsImNvbXBvbmVudCIsImFkZENvbXBvbmVudCIsImV2ZW50cyIsInN5c3RlbXMiLCJlbnRpdGllcyIsImNvbXBvbmVudHMiLCJNYXAiLCJlbnRpdHlJZCIsInN5c3RlbSIsInF1ZXJ5IiwicHVzaCIsInFSZXN1bHQiLCJxdWVyeUNvbXBvbmVudHMiLCJsZW5ndGgiLCJlbnRpdHlCdWlsZGVyIiwiY3JlYXRlRW50aXR5IiwiY29tcE5hbWUiLCJpZGVudGlmaWVyIiwiaGFzIiwic2V0IiwiQXJyYXkiLCJhY3R1YWxDb21wb25lbnQiLCJkYXRhIiwiZW50aXR5SWRSZWR1Y2VyIiwicHJldmlvdXNWYWx1ZXMiLCJmaW5kIiwicmVzdWx0IiwicSIsInRoaXNSZXN1bHQiLCJjb21wb25lbnRJZGVudGlmaWVyIiwiZmlsdGVyIiwiaXNOYU4iLCJyZWR1Y2UiLCJ0b2tlbiIsIkZJUlNUIiwiQU5EIiwibGVhc3QiLCJiaWdnZXN0IiwiYiIsIk9SIiwiY29uY2F0IiwiY29tcG9uZW50SWRzIiwiY0lkIiwicXVlcnlFbnRpdGllcyIsImVudGl0eSIsImNvbXBJbmRleCIsImZpbmRJbmRleCIsImluZGV4T2YiLCJlbnRyeSIsImFyZ3MiLCJhcmdDb21wIiwiaW5kZXgiLCJldmVudCIsImNyZWF0ZUFyZ3MiLCJwcmV2UnVuIiwiRGF0ZSIsIm5vdyIsImRlbHRhVGltZSJdLCJtYXBwaW5ncyI6ImFBQ0UsSUFBSUEsRUFBbUIsR0FHdkIsU0FBU0MsRUFBb0JDLEdBRzVCLEdBQUdGLEVBQWlCRSxHQUNuQixPQUFPRixFQUFpQkUsR0FBVUMsUUFHbkMsSUFBSUMsRUFBU0osRUFBaUJFLEdBQVksQ0FDekNHLEVBQUdILEVBQ0hJLEdBQUcsRUFDSEgsUUFBUyxJQVVWLE9BTkFJLEVBQVFMLEdBQVVNLEtBQUtKLEVBQU9ELFFBQVNDLEVBQVFBLEVBQU9ELFFBQVNGLEdBRy9ERyxFQUFPRSxHQUFJLEVBR0pGLEVBQU9ELFFBS2ZGLEVBQW9CUSxFQUFJRixFQUd4Qk4sRUFBb0JTLEVBQUlWLEVBR3hCQyxFQUFvQlUsRUFBSSxTQUFTUixFQUFTUyxFQUFNQyxHQUMzQ1osRUFBb0JhLEVBQUVYLEVBQVNTLElBQ2xDRyxPQUFPQyxlQUFlYixFQUFTUyxFQUFNLENBQUVLLFlBQVksRUFBTUMsSUFBS0wsS0FLaEVaLEVBQW9Ca0IsRUFBSSxTQUFTaEIsR0FDWCxvQkFBWGlCLFFBQTBCQSxPQUFPQyxhQUMxQ04sT0FBT0MsZUFBZWIsRUFBU2lCLE9BQU9DLFlBQWEsQ0FBRUMsTUFBTyxXQUU3RFAsT0FBT0MsZUFBZWIsRUFBUyxhQUFjLENBQUVtQixPQUFPLEtBUXZEckIsRUFBb0JzQixFQUFJLFNBQVNELEVBQU9FLEdBRXZDLEdBRFUsRUFBUEEsSUFBVUYsRUFBUXJCLEVBQW9CcUIsSUFDL0IsRUFBUEUsRUFBVSxPQUFPRixFQUNwQixHQUFXLEVBQVBFLEdBQThCLGlCQUFWRixHQUFzQkEsR0FBU0EsRUFBTUcsV0FBWSxPQUFPSCxFQUNoRixJQUFJ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V2MsSUFBSXVCLEVBQUtHLElBS3ZGLE9BQU9uQixFQUdELFdBQVdzQixHQUNqQixNQUFNQyxFQUFPLEdBQ2IsSUFBSyxNQUFNakQsS0FBYWdELEVBQU0zQyxXQUFZLENBQ3hDLE1BQU02QyxFQUFVbkQsS0FBS00sV0FBVzdCLElBQUl3QixFQUFVLElBQUlBLEVBQVUsSUFDNURpRCxFQUFLdkMsS0FBS3dDLEdBR1osT0FBT0QsRUFHRixRQUFRRSxFQUFlQyxHQUM1QixJQUFLLE1BQU1SLEtBQVU3QyxLQUFLRyxPQUFPaUQsR0FBT3hDLFFBQVFQLFNBQVUsQ0FDeEQsTUFBTTZDLEVBQU9sRCxLQUFLc0QsV0FBV1QsR0FDN0I3QyxLQUFLRyxPQUFPaUQsR0FBTzNDLE9BQU80QyxFQUFPSCxJQUk5QixXQUNMbEQsS0FBS3VELFFBQVd2RCxLQUFZLFFBQUlBLEtBQUt1RCxRQUFVQyxLQUFLQyxNQUVwRCxNQUFNQSxFQUFNRCxLQUFLQyxNQUVYQyxHQUFhRCxFQUFNekQsS0FBS3VELFNBQVcsSUFDekMsSUFBSyxNQUFNOUMsS0FBVVQsS0FBS0ksUUFDeEIsSUFBSyxNQUFNeUMsS0FBVXBDLEVBQU9HLFFBQVFQLFNBQVUsQ0FDNUMsTUFBTTZDLEVBQU9sRCxLQUFLc0QsV0FBV1QsR0FDN0JwQyxFQUFPQSxPQUFPaUQsRUFBV1IsR0FLN0JsRCxLQUFLdUQsUUFBVUUiLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsImltcG9ydCB7RW50aXR5fSBmcm9tICcuL2VudGl0eSc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29tcG9uZW50UXVlcnlSZXN1bHQge1xuICBlbnRpdGllczogRW50aXR5RW50cnlbXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBFbnRpdHlFbnRyeSB7XG4gIGVudGl0eTogRW50aXR5O1xuICBjb21wb25lbnRzOiBNYXA8c3RyaW5nLCBudW1iZXI+O1xufVxuXG5leHBvcnQgdHlwZSBFc2NRdWVyeSA9IFF1ZXJ5Tm9kZVtdO1xuXG5leHBvcnQgZW51bSBRdWVyeVRva2VuIHtcbiAgRklSU1QsXG4gIEFORCxcbiAgT1IsXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUXVlcnlOb2RlIHtcbiAgLy8gbm90OiBib29sZWFuO1xuICBjb21wb25lbnRJZGVudGlmaWVyOiBzdHJpbmc7XG4gIHRva2VuOiBRdWVyeVRva2VuO1xufVxuIiwiaW1wb3J0IHtTeXN0ZW0sIFN5c3RlbUZufSBmcm9tICcuL3N5c3RlbSc7XG5pbXBvcnQge0VudGl0eX0gZnJvbSAnLi9lbnRpdHknO1xuaW1wb3J0IHtDb21wb25lbnR9IGZyb20gJy4vY29tcG9uZW50JztcbmltcG9ydCB7RXNjUXVlcnksIENvbXBvbmVudFF1ZXJ5UmVzdWx0LCBRdWVyeVRva2VuLCBRdWVyeU5vZGUsIEVudGl0eUVudHJ5fSBmcm9tICcuL2VzYy1xdWVyeSc7XG5pbXBvcnQge0NvbXBvbmVudElkZW50aWZpZXJ9IGZyb20gJy4vY29tcG9uZW50LWlkZW50aWZpZXInO1xuXG5leHBvcnQgY2xhc3MgRW50aXR5QnVpbGRlciB7XG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgaWQ6IG51bWJlciwgcHJpdmF0ZSBlY3NNYW5hZ2VyOiBFQ1NNYW5hZ2VyKSB7fVxuXG4gIGdldCBlbnRpdHlJZCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmlkO1xuICB9XG5cbiAgcHVibGljIGFkZENvbXBvbmVudDxUIGV4dGVuZHMgQ29tcG9uZW50SWRlbnRpZmllcj4oY29tcG9uZW50OiBUKTogRW50aXR5QnVpbGRlciB7XG4gICAgcmV0dXJuIHRoaXMuZWNzTWFuYWdlci5hZGRDb21wb25lbnQodGhpcy5pZCwgY29tcG9uZW50KTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgRUNTTWFuYWdlciB7XG4gIHByaXZhdGUgZXZlbnRzOiBTeXN0ZW08RXZlbnQ+W10gPSBbXTtcbiAgcHJpdmF0ZSBzeXN0ZW1zOiBTeXN0ZW08bnVtYmVyPltdID0gW107XG4gIHByaXZhdGUgZW50aXRpZXM6IEVudGl0eVtdID0gW107XG4gIC8vIFRPRE86IG5vIGlkZWEgd2hhdCBub3RhdGlvbiB0byBzYXkgQ29tcG9uZW50PFQ+W10sIHNvIEkgdXNlIGFueVtdIGZvciBub3dcbiAgcHJpdmF0ZSBjb21wb25lbnRzID0gbmV3IE1hcDxzdHJpbmcsIGFueVtdPigpO1xuXG4gIHByaXZhdGUgZW50aXR5SWQgPSAwO1xuXG4gIHByaXZhdGUgcHJldlJ1bjogbnVtYmVyO1xuXG4gIHB1YmxpYyByZWdpc3RlckV2ZW50PFQgZXh0ZW5kcyBDb21wb25lbnRJZGVudGlmaWVyPihcbiAgICBzeXN0ZW06IFN5c3RlbUZuPEV2ZW50PixcbiAgICBxdWVyeTogRXNjUXVlcnkpXG4gICAgOiBudW1iZXIge1xuICAgIHRoaXMuZXZlbnRzLnB1c2goe1xuICAgICAgcVJlc3VsdDogdGhpcy5xdWVyeUNvbXBvbmVudHMocXVlcnkpLFxuICAgICAgc3lzdGVtXG4gICAgfSk7XG5cbiAgICByZXR1cm4gdGhpcy5ldmVudHMubGVuZ3RoIC0gMTtcbiAgfVxuXG4gIHB1YmxpYyByZWdpc3RlclN5c3RlbTxUIGV4dGVuZHMgQ29tcG9uZW50SWRlbnRpZmllcj4oXG4gICAgc3lzdGVtOiBTeXN0ZW1GbjxudW1iZXI+LFxuICAgIHF1ZXJ5OiBFc2NRdWVyeSlcbiAgICA6IHZvaWQge1xuICAgIHRoaXMuc3lzdGVtcy5wdXNoKHtcbiAgICAgIHFSZXN1bHQ6IHRoaXMucXVlcnlDb21wb25lbnRzKHF1ZXJ5KSxcbiAgICAgIHN5c3RlbVxuICAgIH0pO1xuICB9XG5cbiAgcHVibGljIGNyZWF0ZUVudGl0eSgpOiBFbnRpdHlCdWlsZGVyIHtcbiAgICB0aGlzLmVudGl0aWVzLnB1c2goeyBpZDogdGhpcy5lbnRpdHlJZCsrIH0pO1xuICAgIHJldHVybiBuZXcgRW50aXR5QnVpbGRlcih0aGlzLmVudGl0eUlkIC0gMSwgdGhpcyk7XG4gIH1cblxuICBwdWJsaWMgY3JlYXRlRW50aXR5V2l0aENvbXBvbmVudHM8VCBleHRlbmRzIENvbXBvbmVudElkZW50aWZpZXI+KGNvbXBvbmVudHM6IFRbXSk6IEVudGl0eUJ1aWxkZXIge1xuICAgIGNvbnN0IGVudGl0eUJ1aWxkZXIgPSB0aGlzLmNyZWF0ZUVudGl0eSgpO1xuICAgIGZvciAoY29uc3QgY29tcG9uZW50IG9mIGNvbXBvbmVudHMpIHtcbiAgICAgIHRoaXMuYWRkQ29tcG9uZW50KGVudGl0eUJ1aWxkZXIuZW50aXR5SWQsIGNvbXBvbmVudCk7XG4gICAgfVxuICAgIHJldHVybiBuZXcgRW50aXR5QnVpbGRlcih0aGlzLmVudGl0eUlkIC0gMSwgdGhpcyk7XG4gIH1cblxuICAvLyBUT0RPOiB1cGRhdGUgcmVsZXZhbnQgc3lzdGVtcyBxdWVyeSByZXN1bHRzXG4gIHB1YmxpYyBhZGRDb21wb25lbnQ8VCBleHRlbmRzIENvbXBvbmVudElkZW50aWZpZXI+KGVudGl0eUlkOiBudW1iZXIsIGNvbXBvbmVudDogVCk6IEVudGl0eUJ1aWxkZXIge1xuICAgIGNvbnN0IGNvbXBOYW1lID0gY29tcG9uZW50LmlkZW50aWZpZXIoKTtcbiAgICBpZiAoIXRoaXMuY29tcG9uZW50cy5oYXMoY29tcE5hbWUpKSB7XG4gICAgICB0aGlzLmNvbXBvbmVudHMuc2V0KGNvbXBOYW1lLCBuZXcgQXJyYXk8Q29tcG9uZW50PHR5cGVvZiBjb21wTmFtZT4+KCkpO1xuICAgIH1cbiAgICBjb25zdCBhY3R1YWxDb21wb25lbnQgPSB7ZW50aXR5SWQsIGRhdGE6IGNvbXBvbmVudH07XG4gICAgdGhpcy5jb21wb25lbnRzLmdldChjb21wTmFtZSkucHVzaChhY3R1YWxDb21wb25lbnQpO1xuXG4gICAgcmV0dXJuIG5ldyBFbnRpdHlCdWlsZGVyKGVudGl0eUlkLCB0aGlzKTtcbiAgfVxuXG4gIHB1YmxpYyBxdWVyeUVudGl0aWVzKHF1ZXJ5OiBFc2NRdWVyeSk6IEVudGl0eVtdIHtcbiAgICBjb25zdCBlbnRpdHlJZFJlZHVjZXIgPSAocHJldmlvdXNWYWx1ZXM6IEVudGl0eVtdLCB2YWx1ZTogQ29tcG9uZW50PGFueT4pID0+IHtcbiAgICAgIGlmICghcHJldmlvdXNWYWx1ZXMuZmluZChuID0+IG4uaWQgPT09IHZhbHVlLmVudGl0eUlkKSkge1xuICAgICAgICBwcmV2aW91c1ZhbHVlcy5wdXNoKHsgaWQ6IHZhbHVlLmVudGl0eUlkIH0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHByZXZpb3VzVmFsdWVzO1xuICAgIH07XG4gICAgbGV0IHJlc3VsdDogRW50aXR5W10gPSBbXTtcbiAgICBmb3IgKGNvbnN0IHEgb2YgcXVlcnkpIHtcbiAgICAgIGNvbnN0IHRoaXNSZXN1bHQ6IEVudGl0eVtdID0gdGhpcy5jb21wb25lbnRzLmdldChxLmNvbXBvbmVudElkZW50aWZpZXIpLmZpbHRlcihjID0+ICFpc05hTihjLmVudGl0eUlkKSkucmVkdWNlKGVudGl0eUlkUmVkdWNlciwgW10pO1xuICAgICAgc3dpdGNoIChxLnRva2VuKSB7XG4gICAgICAgIGNhc2UgUXVlcnlUb2tlbi5GSVJTVDpcbiAgICAgICAgICByZXN1bHQgPSB0aGlzUmVzdWx0O1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFF1ZXJ5VG9rZW4uQU5EOlxuICAgICAgICAgIGNvbnN0IGxlYXN0ID0gKHRoaXNSZXN1bHQubGVuZ3RoIDwgcmVzdWx0Lmxlbmd0aCkgPyB0aGlzUmVzdWx0IDogcmVzdWx0O1xuICAgICAgICAgIGNvbnN0IGJpZ2dlc3QgPSAodGhpc1Jlc3VsdC5sZW5ndGggPj0gcmVzdWx0Lmxlbmd0aCkgPyB0aGlzUmVzdWx0IDogcmVzdWx0O1xuICAgICAgICAgIHJlc3VsdCA9IFtdO1xuICAgICAgICAgIGZvciAoY29uc3QgciBvZiBsZWFzdCkge1xuICAgICAgICAgICAgaWYgKGJpZ2dlc3QuZmluZChiID0+IGIgPT09IHIpKSB7XG4gICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBRdWVyeVRva2VuLk9SOlxuICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdC5jb25jYXQodGhpc1Jlc3VsdCkucmVkdWNlKChwcmV2aW91c1ZhbHVlczogRW50aXR5W10sIHZhbHVlOiBFbnRpdHkpID0+IHtcbiAgICAgICAgICAgIGlmICghcHJldmlvdXNWYWx1ZXMuZmluZChuID0+IG4uaWQgPT09IHZhbHVlLmlkKSkge1xuICAgICAgICAgICAgICBwcmV2aW91c1ZhbHVlcy5wdXNoKHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBwcmV2aW91c1ZhbHVlcztcbiAgICAgICAgICB9LCBbXSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG5cbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgcHVibGljIHF1ZXJ5Q29tcG9uZW50cyhxdWVyeTogRXNjUXVlcnkpOiBDb21wb25lbnRRdWVyeVJlc3VsdCB7XG4gICAgY29uc3QgcXVlcnlSZWR1Y2VyID0gKHByZXZpb3VzVmFsdWVzOiBzdHJpbmdbXSwgdmFsdWU6IFF1ZXJ5Tm9kZSkgPT4ge1xuICAgICAgaWYgKCFwcmV2aW91c1ZhbHVlcy5maW5kKGNJZCA9PiBjSWQgPT09IHZhbHVlLmNvbXBvbmVudElkZW50aWZpZXIpKSB7XG4gICAgICAgIHByZXZpb3VzVmFsdWVzLnB1c2godmFsdWUuY29tcG9uZW50SWRlbnRpZmllcik7XG4gICAgICB9XG4gICAgICByZXR1cm4gcHJldmlvdXNWYWx1ZXM7XG4gICAgfTtcblxuICAgIGNvbnN0IGNvbXBvbmVudElkcyA9IHF1ZXJ5LnJlZHVjZShxdWVyeVJlZHVjZXIsIFtdKTtcbiAgICBjb25zdCBlbnRpdGllcyA9IHRoaXMucXVlcnlFbnRpdGllcyhxdWVyeSk7XG5cbiAgICBjb25zdCByZXN1bHQ6IENvbXBvbmVudFF1ZXJ5UmVzdWx0ID0ge1xuICAgICAgZW50aXRpZXM6IFtdXG4gICAgfTtcblxuICAgIGZvciAoY29uc3QgY0lkIG9mIGNvbXBvbmVudElkcykge1xuICAgICAgZm9yIChjb25zdCBlbnRpdHkgb2YgZW50aXRpZXMpIHtcbiAgICAgICAgY29uc3QgY29tcEluZGV4ID0gdGhpcy5jb21wb25lbnRzLmdldChjSWQpLmZpbmRJbmRleChjID0+IGMuZW50aXR5SWQgPT09IGVudGl0eSk7XG4gICAgICAgIGlmIChjb21wSW5kZXggPj0gMCkge1xuICAgICAgICAgIGxldCBpbmRleE9mID0gcmVzdWx0LmVudGl0aWVzLmZpbmRJbmRleChlbnRyeSA9PiBlbnRyeS5lbnRpdHkuaWQgPT09IGVudGl0eS5pZCk7XG4gICAgICAgICAgaWYgKGluZGV4T2YgPT09IC0xKSB7XG4gICAgICAgICAgICByZXN1bHQuZW50aXRpZXMucHVzaCh7XG4gICAgICAgICAgICAgIGVudGl0eSxcbiAgICAgICAgICAgICAgY29tcG9uZW50czogbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpbmRleE9mID0gcmVzdWx0LmVudGl0aWVzLmxlbmd0aCAtIDE7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJlc3VsdC5lbnRpdGllcy5maW5kKGVudHJ5ID0+IGVudHJ5LmVudGl0eS5pZCA9PT0gZW50aXR5LmlkKS5jb21wb25lbnRzLnNldChjSWQsIGNvbXBJbmRleCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVBcmdzKGVudHJ5OiBFbnRpdHlFbnRyeSkge1xuICAgIGNvbnN0IGFyZ3MgPSBbXTtcbiAgICBmb3IgKGNvbnN0IGNvbXBvbmVudCBvZiBlbnRyeS5jb21wb25lbnRzKSB7XG4gICAgICBjb25zdCBhcmdDb21wID0gdGhpcy5jb21wb25lbnRzLmdldChjb21wb25lbnRbMF0pW2NvbXBvbmVudFsxXV07XG4gICAgICBhcmdzLnB1c2goYXJnQ29tcCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGFyZ3M7XG4gIH1cblxuICBwdWJsaWMgb25FdmVudChpbmRleDogbnVtYmVyLCBldmVudDogRXZlbnQpIHtcbiAgICBmb3IgKGNvbnN0IGVudGl0eSBvZiB0aGlzLmV2ZW50c1tpbmRleF0ucVJlc3VsdC5lbnRpdGllcykge1xuICAgICAgY29uc3QgYXJncyA9IHRoaXMuY3JlYXRlQXJncyhlbnRpdHkpO1xuICAgICAgdGhpcy5ldmVudHNbaW5kZXhdLnN5c3RlbShldmVudCwgYXJncyk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIGRpc3BhdGNoKCkge1xuICAgIHRoaXMucHJldlJ1biA9ICh0aGlzLnByZXZSdW4pID8gdGhpcy5wcmV2UnVuIDogRGF0ZS5ub3coKTtcblxuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG5cbiAgICBjb25zdCBkZWx0YVRpbWUgPSAobm93IC0gdGhpcy5wcmV2UnVuKSAvIDEwMDA7XG4gICAgZm9yIChjb25zdCBzeXN0ZW0gb2YgdGhpcy5zeXN0ZW1zKSB7XG4gICAgICBmb3IgKGNvbnN0IGVudGl0eSBvZiBzeXN0ZW0ucVJlc3VsdC5lbnRpdGllcykge1xuICAgICAgICBjb25zdCBhcmdzID0gdGhpcy5jcmVhdGVBcmdzKGVudGl0eSk7XG4gICAgICAgIHN5c3RlbS5zeXN0ZW0oZGVsdGFUaW1lLCBhcmdzKTtcbiAgICAgIH1cbiAgICB9XG5cblxuICAgIHRoaXMucHJldlJ1biA9IG5vdztcbiAgfVxufVxuIl0sInNvdXJjZVJvb3QiOiIifQ==